## PixelPlay — かんたん画像加工（Streamlit）

PixelPlay は、ブラウザ上で画像にフィルター適用・サイズ変更・切り抜き・フォトモザイクなどを手軽に行える Streamlit アプリです。複数画像の一括処理や ZIP ダウンロードにも対応しています。

主な機能:

- 複数画像の一括処理とプレビュー表示
- 各種フィルター（グレースケール、ぼかし、輪郭、セピア、反転、など）
- リサイズ・切り抜き・回転等の基本編集
- フォトモザイク（Photomosaic）
  - `tiler/tiles` 配下の全タイルセットを自動検出して選択可能
  - 1つのノブで「目の細かさ」を調整（内部で画像スケールとタイル倍率を調整）
  - Various sizes（複数タイル倍率の混在）対応でリッチな表現に
  - カラー分割（色量子化の粒度）を 4〜256 で調整可能


## セットアップ

前提: Python 3.10+（推奨）

依存関係は `pyproject.toml` に定義されています。通常の `pip` もしくは `uv` などでインストールしてください。

```bash
# 例: pip を使う場合
pip install -e .

# 例: uv を使う場合（お好みで）
uv sync
```


## 起動方法

```bash
streamlit run app.py
```

ブラウザで表示された UI に従い、画像をアップロードして加工を選択します。


## フォトモザイクの使い方

1. 「2. 加工をえらぶ」で「フォトモザイク」を選択
2. 「タイルセット」から `tiler/tiles` 配下の任意のセットを選ぶ
	- 例: `circles/gen_circle_100`, `circles/gen_circle_200`, `times/gen_times`, `plus/gen_plus`, `minecraft` など
3. 「目の細かさ」スライダー（1〜10）で粒度を調整
	- 数字が大きいほど細かくなります（処理時間やメモリ使用量も増加）
4. 必要に応じて「Various sizes（複数サイズのタイルを混ぜる）」をオンにし、複数のタイル倍率を選択
	- 例: 1.0, 0.5, 0.25 を混ぜると粒度が混ざってリッチな見た目になります
5. 「カラー分割」を調整（大きいほど色再現が精密・重くなります）

メモ:

- タイルの事前読み込みはキャッシュされ、同一タイルセット＋倍率の組み合わせでは再読込を避けます。
- 固定グリッドで敷き詰めるため、ピクセルシフトは自動調整（`auto`）になっています。
- 非常に細かい設定や倍率を多く選ぶと、処理時間・メモリ使用量が増えます。プレビューで様子を見ながら調整してください。


## タイルセットについて

`tiler/tiles` 配下にあるフォルダ（例: `circles/gen_circle_100`）が 1 つのタイルセットとして扱われます。サブフォルダがないタイプ（例: `minecraft`）はフォルダ直下の画像群がタイルとして読み込まれます。新しいタイルセットを追加したい場合は、同様の構成で画像を配置してください。


## ライセンスと謝辞（Attribution）

- 本プロジェクトは、MIT ライセンスの下で公開されています。詳細はリポジトリ直下の `LICENSE` をご覧ください。
- 本リポジトリは、nuno-faria/tiler のコードを同梱し、最小限の改変を加えて利用しています。
  - nuno-faria/tiler: https://github.com/nuno-faria/tiler （MIT License）
  - 同梱・改変されたコードのライセンス表記は `tiler/LICENSE.md` に含まれています。原著作権表示とライセンス条項はそのまま保持しています。
  - 主な変更点（概要）:
    - パッケージ化・相対インポート化（`tiler/__init__.py` を追加、内部 import の整理）
    - Streamlit/PIL との連携 API を追加（`build_mosaic_from_pil` など）
    - 固定グリッド化のため `pixel_shift='auto'` オプションを追加
    - キャッシュ連携や色量子化パラメータの UI 露出など、アプリ都合の薄いラッパー・調整
  - それ以外のアルゴリズム的な中核部分は、原プロジェクトに依拠しています。


## 開発メモ

- 主要依存: `streamlit`, `pillow`, `numpy`, `opencv-python-headless`, `tqdm`
- テスト用スモークスクリプト: `tests/smoke_mosaic.py`（出力は `tests/_outputs/` に保存）
- 大規模画像や超高密度設定では計算が重くなります。必要に応じて倍率やカラー分割を下げてご利用ください。

